{% extends "base.html" %}

{% block title %}–î–µ—Ç–∞–ª–∏ –∑–∞–º–µ—Ç–∫–∏{% endblock %}

{% block content %}
    <div class="container mt-4">
        <div class="card shadow {% if note.is_secret %}border-danger{% else %}border-primary{% endif %}">
            <div class="card-body">
                <h5 class="card-title">
                    {% if note.is_secret %} üîí –°–µ–∫—Ä–µ—Ç–Ω–∞—è {% else %} üìù –û–±—ã—á–Ω–∞—è {% endif %}
                </h5>
                <p class="card-text">{{ note.text }}</p>
                <p class="text-muted">
                    <span id="status-{{ note.id }}">
                        {% if note.is_read %} ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–∞ {% else %} ‚ùå –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ {% endif %}
                    </span>
                </p>
                <button class="btn {% if note.is_read %}btn-warning{% else %}btn-success{% endif %} toggle-read" 
                        data-id="{{ note.id }}">
                    {% if note.is_read %} –°–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π {% else %} –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π {% endif %}
                </button>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É" -->
                <div class="d-flex justify-content-between mt-3">
                    <a href="{% url 'note_list' %}" class="btn btn-secondary">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let button = document.querySelector(".toggle-read");
            let noteId = button.getAttribute("data-id");
            let statusSpan = document.getElementById(`status-${noteId}`);

            button.addEventListener("click", function () {
                fetch(`/toggle-read/${noteId}/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken"),
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        statusSpan.innerHTML = data.is_read ? "‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–∞" : "‚ùå –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞";
                        button.classList.toggle("btn-success", !data.is_read);
                        button.classList.toggle("btn-warning", data.is_read);
                        button.innerText = data.is_read ? "–°–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π" : "–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π";
                    }
                });
            });
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                let cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + "=")) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
{% endblock %}
