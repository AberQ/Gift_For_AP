{% extends "base.html" %}

{% block title %}(À∂·µî ·µï ·µîÀ∂)–î–µ—Ç–∞–ª–∏ –∫—Ä—É–ø–∏—Ü—ã –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è(À∂·µî ·µï ·µîÀ∂){% endblock %}

{% block content %}
    <style>
        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è */
        .fade-in {
            opacity: 0;
            animation: fadeIn 1s forwards;
        }

        /* –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px); /* –ù–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ - —Å–¥–≤–∏–≥ –≤–Ω–∏–∑ */
            }
            100% {
                opacity: 1;
                transform: translateY(0); /* –ö–æ–Ω–µ—á–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ - –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ */
            }
        }
    </style>

    <div class="container mt-4 fade-in">
        <div class="card shadow {% if note.is_secret %}border-danger{% else %}border-primary{% endif %}">
            <div class="card-body">
                <h5 class="card-title">
                    {% if note.is_secret %} üîí –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è {% else %} üìù –û–±—ã—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è {% endif %}
                </h5>
                <p class="card-text">{{ note.text }}</p>
                <p class="text-muted">
                    <span id="status-{{ note.id }}">
                        {% if note.is_read %} ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–∞ {% else %} ‚ùå –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ {% endif %}
                    </span>
                </p>

                <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å -->
                {% if note.photo %}
                    <div class="mt-3 fade-in">
                        <img src="{{ note.photo.url }}" alt="–§–æ—Ç–æ –∑–∞–º–µ—Ç–∫–∏" class="img-fluid">
                    </div>
                {% endif %}

                <!-- –ö–Ω–æ–ø–∫–∞ "–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π" —Ç–µ–ø–µ—Ä—å –ø–æ–¥ —Ñ–æ—Ç–æ -->
                <button class="btn {% if note.is_read %}btn-warning{% else %}btn-success{% endif %} toggle-read mt-3 fade-in" 
                        data-id="{{ note.id }}">
                    {% if note.is_read %} –°–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π {% else %} –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π {% endif %}
                </button>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É" -->
                <div class="d-flex justify-content-between mt-3 fade-in">
                    <a href="{% url 'note_list' %}" class="btn btn-secondary">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let button = document.querySelector(".toggle-read");
            let noteId = button.getAttribute("data-id");
            let statusSpan = document.getElementById(`status-${noteId}`);

            button.addEventListener("click", function () {
                fetch(`/toggle-read/${noteId}/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken"),
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        statusSpan.innerHTML = data.is_read ? "‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–∞" : "‚ùå –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞";
                        button.classList.toggle("btn-success", !data.is_read);
                        button.classList.toggle("btn-warning", data.is_read);
                        button.innerText = data.is_read ? "–°–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π" : "–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π";
                    }
                });
            });
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                let cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + "=")) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
{% endblock %}
