{% extends "base.html" %}

{% block title %}–°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫{% endblock %}

{% block content %}
    <h1 class="text-center mb-4 title">üìå –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h1>

    {% if notes %}
        <div class="row">
            {% for note in notes %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <a href="{% url 'note_detail' note.id %}" class="card shadow {% if note.is_secret %}border-danger{% else %}border-primary{% endif %} text-decoration-none">
                        <div class="card-body">
                            <h5 class="card-title">
                                {% if note.is_secret %} üîí –°–µ–∫—Ä–µ—Ç–Ω–∞—è {% else %} üìù –û–±—ã—á–Ω–∞—è {% endif %}
                            </h5>
                            <p class="card-text">
                                {{ note.text|truncatechars:50 }}
                            </p>
                            <p class="text-muted">
                                <span id="status-{{ note.id }}">
                                    {% if note.is_read %} ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–∞ {% else %} ‚ùå –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ {% endif %}
                                </span>
                            </p>
                            <button class="btn {% if note.is_read %}btn-warning{% else %}btn-success{% endif %} toggle-read" 
                                    data-id="{{ note.id }}">
                                {% if note.is_read %} –°–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π {% else %} –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π {% endif %}
                            </button>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center text-muted">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫.</p>
    {% endif %}

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º GSAP –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
            gsap.from(".title", { opacity: 0, y: -50, duration: 1.5, ease: "power3.out" });

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ (—Ä–∞–∑–ª–µ—Ç + —Å–±–æ—Ä–∫–∞)
            let cards = document.querySelectorAll(".card");
            gsap.set(cards, { opacity: 0, scale: 0.8, x: () => Math.random() * 400 - 200, y: () => Math.random() * 400 - 200, rotation: () => Math.random() * 60 - 30 });

            gsap.to(cards, {
                opacity: 1,
                scale: 1,
                x: 0,
                y: 0,
                rotation: 0,
                duration: 1.5,
                ease: "power3.out",
                stagger: 0.1  // –î–æ–±–∞–≤–ª—è–µ—Ç –ø–ª–∞–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ –æ—á–µ—Ä–µ–¥–∏
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ/–ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ"
            document.querySelectorAll(".toggle-read").forEach(button => {
                button.addEventListener("click", function (event) {
                    event.preventDefault();  
                    let noteId = this.getAttribute("data-id");
                    let button = this;
                    let statusSpan = document.getElementById(`status-${noteId}`);

                    fetch(`/toggle-read/${noteId}/`, {
                        method: "POST",
                        headers: {
                            "X-CSRFToken": getCookie("csrftoken"),
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({})
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            statusSpan.innerHTML = data.is_read ? "‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–∞" : "‚ùå –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞";
                            button.classList.toggle("btn-success", !data.is_read);
                            button.classList.toggle("btn-warning", data.is_read);
                            button.innerText = data.is_read ? "–°–¥–µ–ª–∞—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π" : "–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–π";
                        }
                    });
                });
            });

            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== "") {
                    let cookies = document.cookie.split(";");
                    for (let i = 0; i < cookies.length; i++) {
                        let cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + "=")) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });
    </script>

    <style>
        /* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: scale(1.05);  /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);  /* –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω—å */
        }
    </style>
{% endblock %}
